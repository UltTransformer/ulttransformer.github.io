<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  
    
  <title>Complement your VDI environment with NSX | UltTransformer</title>
  <meta name="author" content="Puppet">
  <meta name="description" content="Part 1: Complement your VDI environment with NSX Part 2: Complement your VDI environment with NSX: dFW Part 3: Complement your VDI environment with NSX: IDFW Part 4: Complement your VDI environment with NSX: Introspection Services Part 5: Complement your VDI environment with NSX: IDS/IPS Part 6: Complement your VDI environment with NSX: Advanced Load Balancer Before I start. Shout out to Bilal Ahmed, a fellow vMusketeer who helped me with this post.">
  <meta name="keywords" content="blog,developer,personal">

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Complement your VDI environment with NSX"/>
<meta name="twitter:description" content="Part 1: Complement your VDI environment with NSX Part 2: Complement your VDI environment with NSX: dFW Part 3: Complement your VDI environment with NSX: IDFW Part 4: Complement your VDI environment with NSX: Introspection Services Part 5: Complement your VDI environment with NSX: IDS/IPS Part 6: Complement your VDI environment with NSX: Advanced Load Balancer Before I start. Shout out to Bilal Ahmed, a fellow vMusketeer who helped me with this post."/>

  <meta property="og:title" content="Complement your VDI environment with NSX" />
<meta property="og:description" content="Part 1: Complement your VDI environment with NSX Part 2: Complement your VDI environment with NSX: dFW Part 3: Complement your VDI environment with NSX: IDFW Part 4: Complement your VDI environment with NSX: Introspection Services Part 5: Complement your VDI environment with NSX: IDS/IPS Part 6: Complement your VDI environment with NSX: Advanced Load Balancer Before I start. Shout out to Bilal Ahmed, a fellow vMusketeer who helped me with this post." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ulttransformer.github.io/posts/complement-your-vdi-environment-with-nsx/complement-your-vdi-environment-with-nsx-idfw/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-01-29T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-01-29T00:00:00+00:00" />

  <link rel="stylesheet" href="/css/bootstrap.min.css"  crossorigin="anonymous">
  
  <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css" rel="stylesheet" type="text/css">

  <link rel="stylesheet" href="/sass/main.css">

  <link rel="stylesheet" href="/zoomjs/zoom.min.css">

  <script src=/js/lazysizes.min.js></script>

  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  

</head>



<body ontouchstart="">
  <nav class="navbar navbar-default navbar-custom navbar-fixed-top ">
  <div class="container-fluid">
    
    <div class="navbar-header page-scroll">
      <button type="button" class="navbar-toggle">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://ulttransformer.github.io">UltTransformer</a>
    </div>
    
    <div id="huxblog_navbar">
      <div class="navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          
          <li><a href="/" title="Home">Home</a></li>
          
          <li><a href="/posts/" title="Posts">Posts</a></li>
          
          <li><a href="/about/" title="About">About</a></li>
          

          <li class="search-icon">
            <a href="javascript:void(0)">
              <i class="fa fa-search"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
    
  </div>
  
</nav>
<script>
  
  
  
  var $body = document.body;
  var $toggle = document.querySelector(".navbar-toggle");
  var $navbar = document.querySelector("#huxblog_navbar");
  var $collapse = document.querySelector(".navbar-collapse");

  var __HuxNav__ = {
    close: function () {
      $navbar.className = " ";
      
      setTimeout(function () {
        
        if ($navbar.className.indexOf("in") < 0) {
          $collapse.style.height = "0px";
        }
      }, 400);
    },
    open: function () {
      $collapse.style.height = "auto";
      $navbar.className += " in";
    },
  };

  
  $toggle.addEventListener("click", function (e) {
    if ($navbar.className.indexOf("in") > 0) {
      __HuxNav__.close();
    } else {
      __HuxNav__.open();
    }
  });

  

  document.addEventListener("click", function (e) {
    if (e.target == $toggle) return;
    if (e.target.className == "icon-bar") return;
    __HuxNav__.close();
  });
</script>
  
<div class="search-page">
  <div class="search-icon-close-container">
    <span class="search-icon-close">
      <i class="fa fa-chevron-down"></i>
    </span>
  </div>
  <div class="search-main container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <form></form>
        <input type="text" id="search-input" placeholder="$ grep...">
        </form>
        <div id="search-results" class="mini-post-list"></div>
      </div>
    </div>
  </div>
</div>

  
  


<style type="text/css">
  header.intro-header {
    position: relative;
    background-image: url('/img/home-bg.jpg');
  }
</style>

<header class="intro-header ">

  <div class="header-mask"></div>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-heading">
          <div class="tags">
            
            <a class="tag" href="/tags/nsx/" title="NSX">NSX</a>
            
          </div>
          <h1>Complement your VDI environment with NSX</h1>
          <h2 class="subheading">IDFW</h2>
          <span class="meta">
            Posted by  Chris Noon 
            on Fri, Jan 29, 2021
          </span>
        </div>
      </div>
    </div>
  </div>
</header>


  


<article>
  <div class="container">
    <div class="row">

      
      <div class="
              col-lg-8 col-lg-offset-2
              col-md-10 col-md-offset-1
              post-container">
        <ul>
<li><a href="https://www.ulttransformer.com/posts/complement-your-vdi-environment-with-nsx/complement-your-vdi-environment-with-nsx/" target="_blank">Part 1: Complement your VDI environment with NSX</a></li>
<li><a href="https://www.ulttransformer.com/posts/complement-your-vdi-environment-with-nsx/complement-your-vdi-environment-with-nsx-dfw/" target="_blank">Part 2: Complement your VDI environment with NSX: dFW</a></li>
<li><a href="https://www.ulttransformer.com/posts/complement-your-vdi-environment-with-nsx/complement-your-vdi-environment-with-nsx-idfw/" target="_blank">Part 3: Complement your VDI environment with NSX: IDFW</a></li>
<li><a href="https://www.ulttransformer.com/posts/complement-your-vdi-environment-with-nsx/complement-your-vdi-environment-with-nsx-introspection-services/" target="_blank">Part 4: Complement your VDI environment with NSX: Introspection Services</a></li>
<li><a href="https://www.ulttransformer.com/posts/complement-your-vdi-environment-with-nsx/complement-your-vdi-environment-with-nsx-ids-ips/" target="_blank">Part 5: Complement your VDI environment with NSX: IDS/IPS</a></li>
<li><a href="https://www.ulttransformer.com/posts/complement-your-vdi-environment-with-nsx/complement-your-vdi-environment-with-nsx/" target="_blank">Part 6: Complement your VDI environment with NSX: Advanced Load Balancer</a></li>
</ul>
<p>Before I start. Shout out to <a href="https://twitter.com/Dark_KnightUK" target="_blank">Bilal Ahmed</a>, a fellow vMusketeer who helped me with this post.</p>
<p>In this part of the series, we will look into IDFW (Identity Firewalling). IDFW is becoming an increasingly popular feature in VDI and RDSH environments. It allows security constructs to be applied to AD (Active Directory) groups, rather than the IP addresses. This promotes ease of mobility and reduction of operational effort on Day 2. This also helps security and compliance meet their goals in an ever-changing (COVID19) world.</p>
<h3 id="identity-firewall-concepts">Identity Firewall Concepts.<a class="anchorjs-link" href="#identity-firewall-concepts"></a></h3><p>The IDFW functionality peers the NSX Managers with an authentication system, most commonly AD (or LDAP). It then allows the NSX administrators or security administrators to create NSX groups, based on AD groups. Subsequently, you can apply these dynamic groups to the dFW rules for a secure yet dynamic environment.</p>
<p>An example of this would be Jane in accounts. Jane logs into her VDI and using the power of NSX, dFW rules are pushed to the VM NIC permitting and/or denying access to specific accounts applications or areas of the network. If Jane was to move departments, say to finance, then typically Jane would have her VDI moved to another network, or be assigned a new VDI which is restricted based on her new requirements. Not when using NSX! The Network operational task is removed! When Jane is moved from AD group “accounts” to AD group “finance”, NSX realizes this and on Jane’s next login, that same VDI gets a fresh set of finance-related rules.</p>
<h3 id="links-to-documentation">Links to Documentation<a class="anchorjs-link" href="#links-to-documentation"></a></h3><p>There is some great <a href="https://docs.vmware.com/en/VMware-NSX-T-Data-Center/3.1/administration/GUID-F15C4916-CEBF-47A0-A6A8-64428190B08D.html" target="_blank">VMware documentation on IDFW</a> and if you are interested in deploying IDFW, definitely check it out.</p>
<h3 id="enabling-the-identity-firewall">Enabling the Identity Firewall.<a class="anchorjs-link" href="#enabling-the-identity-firewall"></a></h3><p>First of all, you need to enable the IDFW feature on the VDI cluster. This can be done by following the below procedure:</p>
<p>Select Security &gt; Distributed Firewall.</p>
<p>In the right corner, click Actions &gt; General Settings.</p>
<p>Click Identity Firewall Settings.</p>
<p>Toggle the status button to enable IDFW on the VDI cluster.</p>
<p>N.B. You may need to enable the IDFW feature in the General Firewall Settings.</p>
<p>Click Save</p>
<p><figure>
  <a class="paragraph-image">
    <img data-src="/img/complement-your-vdi-environment-with-nsx/idfw-general-firewall-settings.png" data-action="zoom" alt="General Firewall Settings"  class="lazyload">
  </a>
  
</figure></p>
<p>Once you have enabled IDFW on the cluster, you’ll need to link the NSX Manager to the AD server. This can be done by following the below procedure:</p>
<p>Navigate to System &gt; Identity Firewall AD &gt; Active Directory.</p>
<p>Click Add Active Directory.</p>
<p>Enter the name of the active directory.</p>
<p>Enter the NetBios Name and Base Distinguished Name.</p>
<p>Create an LDAP Server.</p>
<p>Click Save.</p>
<p><figure>
  <a class="paragraph-image">
    <img data-src="/img/complement-your-vdi-environment-with-nsx/idfw-AD.png" data-action="zoom" alt="Create LDAP"  class="lazyload">
  </a>
  
</figure></p>
<p>Finally, sync the newly configured AD server groups to the NSX Manager. This can be done by following the below procedure:</p>
<p>Navigate to System &gt; Identity Firewall AD &gt; Active Directory.</p>
<p>Click the three-button menu icon next to the Active Directory that you want to synchronize and select Sync All.</p>
<p>Wait for the synchronization to complete.</p>
<p><figure>
  <a class="paragraph-image">
    <img data-src="/img/complement-your-vdi-environment-with-nsx/idfw-AD-sync.png" data-action="zoom" alt="Wait for sync"  class="lazyload">
  </a>
  
</figure></p>
<h3 id="adding-groups">Adding Groups<a class="anchorjs-link" href="#adding-groups"></a></h3><p>Now that the NSX Manager has been synced with the AD Server. I can create groups based on AD variables.</p>
<p>Creating AD groups can be achieved by following the below procedure:</p>
<p>Select Inventory &gt; Groups from the navigation panel.</p>
<p>Click Add Group.</p>
<p>Enter a group name.</p>
<p>Click Set Members.</p>
<p>Click AD Groups to add Active Directory Groups.</p>
<p>Click Apply and then Save.</p>
<p><figure>
  <a class="paragraph-image">
    <img data-src="/img/complement-your-vdi-environment-with-nsx/idfw-AD-groups.png" data-action="zoom" alt="AD Groups"  class="lazyload">
  </a>
  
</figure></p>
<h3 id="adding-rules">Adding Rules<a class="anchorjs-link" href="#adding-rules"></a></h3><p>When adding dFW rule, general principles should be followed.</p>
<p>dFW was covered in part 1 of the series:</p>
<p><a href="https://www.ulttransformer.com/posts/complement-your-vdi-environment-with-nsx/complement-your-vdi-environment-with-nsx-dfw/" target="_blank">https://www.ulttransformer.com/posts/complement-your-vdi-environment-with-nsx/complement-your-vdi-environment-with-nsx-dfw/</a></p>
<h3 id="idfw-scaling">IDFW Scaling<a class="anchorjs-link" href="#idfw-scaling"></a></h3><p>I’ve been looking into IDFW for a while and one of the things I can’t find too much literature on is the scalability of the solution, in terms of best practice.</p>
<p>VMware does a terrific job of providing <a href="https://configmax.vmware.com/guest?vmwareproduct=NSX-T%20Data%20Center&amp;release=NSX-T%20Data%20Center%203.1.1&amp;categories=19-47,19-34,19-35,19-36,19-64" target="_blank">configuration maximums</a> but I wanted to discuss the platform itself.</p>
<p>What size NSX Managers should be used?</p>
<p>What resources should be present on the AD Server(s)?</p>
<p>There is no guideline for this and I think it’s for a reason because it varies from environment to environment. Small environments would likely get away with medium size NSX Manager appliances. But when do we scale to large appliances? My recommendation would be to monitor the NSX Appliances and the AD Server(s) and scale vertically or horizontally as appropriate. If you can deploy large NSx Managers from the start, then it helps, but they should still be monitored. The sizing of each component is something you and your customers need to work out on a case by case basis.</p>
<p>I’m working with IDFW more as of late. I’ll look to revisit this section and update it with my experiences of when and why I had to scale the NSX Managers and/or the AD servers.</p>
<h3 id="automate-using-terraform">Automate using Terraform<a class="anchorjs-link" href="#automate-using-terraform"></a></h3><p>Unfortunately, I don’t believe the Terraform provider has the ability to configure the IDFW. However, if I’m mistaken, please point me in the right direction and I’ll update the post.</p>
<p>I do however think it will be available soon, with NSX-T 3.1.1 having “NSX Policy API support for Identity Firewall configuration”. I hope to see an update in the NSX provider in the coming weeks/months. Rest assured, I’ll swing back and update the Automation section.</p>
<p><a href="https://docs.vmware.com/en/VMware-NSX-T-Data-Center/3.1/rn/VMware-NSX-T-Data-Center-311-Release-Notes.html" target="_blank">https://docs.vmware.com/en/VMware-NSX-T-Data-Center/3.1/rn/VMware-NSX-T-Data-Center-311-Release-Notes.html</a></p>


        <hr style="visibility: hidden;" />
        <ul class="pager">
          
          <li class="previous">
            <a href="/posts/complement-your-vdi-environment-with-nsx/complement-your-vdi-environment-with-nsx-dfw/" data-toggle="tooltip" data-placement="top" title="Complement your VDI environment with NSX">
              Previous<br>
              <span>Complement your VDI environment with NSX</span>
            </a>
          </li>
          
          
          <li class="next">
            <a href="/posts/complement-your-vdi-environment-with-nsx/complement-your-vdi-environment-with-nsx-introspection-services/" data-toggle="tooltip" data-placement="top" title="Complement your VDI environment with NSX">
              Next<br>
              <span>Complement your VDI environment with NSX</span>
            </a>
          </li>
          
        </ul>
        <hr style="visibility: hidden;" />

        
        



<div class="giscus" id="comments"></div>
<script src="https://giscus.app/client.js" 
  data-repo="roninro/hugo-theme-puppet" 
  data-repo-id="R_kgDOHuvyhw"
  data-category="General"
  data-category-id="DIC_kwDOHuvyh84CQjDo"
  data-mapping="pathname"
  data-strict="0" 
  data-reactions-enabled="1" 
  data-emit-metadata="0" 
  data-input-position="top"
  data-theme="light_tritanopia"
  data-lang="en"
  crossorigin="anonymous"
  async>
  </script>




      </div>

      
      
      
      
      <div class="
              col-lg-8 col-lg-offset-2
              col-md-10 col-md-offset-1
              sidebar-container">

        
        
        <section>
  
  
  <hr class="hidden-sm hidden-xs">
  
  <h5>FEATURED TAGS</h5>
  <div class="tags">
    
    <a href="/tags/nsx/">NSX</a>
    
    <a href="/tags/vcdx/">VCDX</a>
    
  </div>
</section>

        
        

      </div>
    </div>
  </div>
</article>



  
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        
        <ul class="list-inline text-center">

<li>
  <a href="https://github.com/UltTransformer" target="_blank">
    <span class="fa-stack fa-lg">
      <i class="fa fa-circle fa-stack-2x"></i>
      <i class="fab fa-github fa-stack-1x fa-inverse"></i>
    </span>
  </a>
</li>

<li>
  <a href="https://linkedin.com/in/chrisgrahamnoon" target="_blank">
    <span class="fa-stack fa-lg">
      <i class="fa fa-circle fa-stack-2x"></i>
      <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
    </span>
  </a>
</li>

<li>
  <a href="https://twitter.com/UltTransformer" target="_blank">
    <span class="fa-stack fa-lg">
      <i class="fa fa-circle fa-stack-2x"></i>
      <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
    </span>
  </a>
</li>


<li>
  <a href="/index.xml" target="_blank">
    <span class="fa-stack fa-lg">
      <i class="fa fa-circle fa-stack-2x"></i>
      <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
    </span>
  </a>
</li></ul>

        <p class="copyright text-muted">
          Copyright &copy; UltTransformer 2023  
          <br>
          Powered by <a href="https://gohugo.io">Hugo</a>
        </p>
      </div>
    </div>
  </div>
</footer>

<script src=/js/jquery.min.js></script>
<script src=/js/bootstrap.min.js crossorigin="anonymous"></script>



<script src="/js/hux-blog.min.c4ea77041cd3edbfc8b2622cd887a9a5d8760a4162d14489e36d2a3fa4c90172.js"></script>


<script src=/js/simple-jekyll-search.min.js></script>


<script src="/js/search.min.53bce5da475b4d362500e5ce5dddfa22e20e1b9018777411d2020b4b839c9310.js"></script>













<script src="/zoomjs/zoom.min.js"></script>

</body>

</html>