<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  
    
  <title>Avi Networks | NSX ALB | UltTransformer</title>
  <meta name="author" content="Puppet">
  <meta name="description" content="What is Avi?Avi Networks provides software-defined Load Balancing at its core. Complementing the core service is a plethora of mouthwatering services and features. Surely the reason Avi was acquired by VMware on July 11th 2019. Rebranded as the NSX Advanced Load Balancer.
Some of the features include application analytics, predictive autoscaling, micro-segmentation and WAF (Web Application Firewall) all this and on both cloud and on-prem. The Load Balancer for any platform!">
  <meta name="keywords" content="blog,developer,personal">

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Avi Networks | NSX ALB"/>
<meta name="twitter:description" content="What is Avi?Avi Networks provides software-defined Load Balancing at its core. Complementing the core service is a plethora of mouthwatering services and features. Surely the reason Avi was acquired by VMware on July 11th 2019. Rebranded as the NSX Advanced Load Balancer.
Some of the features include application analytics, predictive autoscaling, micro-segmentation and WAF (Web Application Firewall) all this and on both cloud and on-prem. The Load Balancer for any platform!"/>

  <meta property="og:title" content="Avi Networks | NSX ALB" />
<meta property="og:description" content="What is Avi?Avi Networks provides software-defined Load Balancing at its core. Complementing the core service is a plethora of mouthwatering services and features. Surely the reason Avi was acquired by VMware on July 11th 2019. Rebranded as the NSX Advanced Load Balancer.
Some of the features include application analytics, predictive autoscaling, micro-segmentation and WAF (Web Application Firewall) all this and on both cloud and on-prem. The Load Balancer for any platform!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ulttransformer.github.io/posts/avi-networks-alb/avi-networks-the-advanced-nsx-load-balancer/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-05-09T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-05-09T00:00:00+00:00" />

  <link rel="stylesheet" href="/css/bootstrap.min.css"  crossorigin="anonymous">
  
  <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css" rel="stylesheet" type="text/css">

  <link rel="stylesheet" href="/sass/main.css">

  <link rel="stylesheet" href="/zoomjs/zoom.min.css">

  <script src=/js/lazysizes.min.js></script>

  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  

</head>



<body ontouchstart="">
  <nav class="navbar navbar-default navbar-custom navbar-fixed-top ">
  <div class="container-fluid">
    
    <div class="navbar-header page-scroll">
      <button type="button" class="navbar-toggle">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://ulttransformer.github.io">UltTransformer</a>
    </div>
    
    <div id="huxblog_navbar">
      <div class="navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          
          <li><a href="/" title="Home">Home</a></li>
          
          <li><a href="/posts/" title="Posts">Posts</a></li>
          
          <li><a href="/about/" title="About">About</a></li>
          

          <li class="search-icon">
            <a href="javascript:void(0)">
              <i class="fa fa-search"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
    
  </div>
  
</nav>
<script>
  
  
  
  var $body = document.body;
  var $toggle = document.querySelector(".navbar-toggle");
  var $navbar = document.querySelector("#huxblog_navbar");
  var $collapse = document.querySelector(".navbar-collapse");

  var __HuxNav__ = {
    close: function () {
      $navbar.className = " ";
      
      setTimeout(function () {
        
        if ($navbar.className.indexOf("in") < 0) {
          $collapse.style.height = "0px";
        }
      }, 400);
    },
    open: function () {
      $collapse.style.height = "auto";
      $navbar.className += " in";
    },
  };

  
  $toggle.addEventListener("click", function (e) {
    if ($navbar.className.indexOf("in") > 0) {
      __HuxNav__.close();
    } else {
      __HuxNav__.open();
    }
  });

  

  document.addEventListener("click", function (e) {
    if (e.target == $toggle) return;
    if (e.target.className == "icon-bar") return;
    __HuxNav__.close();
  });
</script>
  
<div class="search-page">
  <div class="search-icon-close-container">
    <span class="search-icon-close">
      <i class="fa fa-chevron-down"></i>
    </span>
  </div>
  <div class="search-main container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <form></form>
        <input type="text" id="search-input" placeholder="$ grep...">
        </form>
        <div id="search-results" class="mini-post-list"></div>
      </div>
    </div>
  </div>
</div>

  
  


<style type="text/css">
  header.intro-header {
    position: relative;
    background-image: url('/img/home-bg.jpg');
  }
</style>

<header class="intro-header ">

  <div class="header-mask"></div>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-heading">
          <div class="tags">
            
            <a class="tag" href="/tags/nsx/" title="NSX">NSX</a>
            
          </div>
          <h1>Avi Networks | NSX ALB</h1>
          <h2 class="subheading">The Advanced NSX Load Balancer</h2>
          <span class="meta">
            Posted by  Chris Noon 
            on Sat, May 9, 2020
          </span>
        </div>
      </div>
    </div>
  </div>
</header>


  


<article>
  <div class="container">
    <div class="row">

      
      <div class="
              col-lg-8 col-lg-offset-2
              col-md-10 col-md-offset-1
              post-container">
        <h3 id="what-is-avi">What is Avi?<a class="anchorjs-link" href="#what-is-avi"></a></h3><p>Avi Networks provides software-defined Load Balancing at its core. Complementing the core service is a plethora of mouthwatering services and features. Surely the reason Avi was acquired by VMware on July 11th 2019. Rebranded as the NSX Advanced Load Balancer.</p>
<p>Some of the features include application analytics, predictive autoscaling, micro-segmentation and WAF (Web Application Firewall) all this and on both cloud and on-prem. The Load Balancer for any platform!</p>
<p>After reading this, if you like the look of Avi and want a demo or PoC, reach out to the team at <a href="https://avinetworks.com/" target="_blank">https://avinetworks.com/</a>.</p>
<h3 id="the-components">The components<a class="anchorjs-link" href="#the-components"></a></h3><p>Avi builds its components in a similar way to other VMware products. A management, control and data plane. The logical separation of components and functions is a tried and tested method that provides robust and scalable solutions.</p>
<p>The management plane and control plane is merged into 1 device a la NSX-T. Named the Controller Cluster, aptly. This provides a configuration portal and an analytics portal for your services/applications. There is also a CLI and RestAPI endpoint should you want to integrate or automate any part of the configuration/analytics. Much like NSX (v or T) the recommended controller deployment size is 3, it will also support a 1 node cluster. The controllers communicate with one another over their management interfaces (encrypted). This can be to pass workload information between each other, share information learnt from the SEs (Service Engines) or push configuration changes towards the SE’s.</p>
<p><figure>
  <a class="paragraph-image">
    <img data-src="https://avinetworks.com/wp-content/uploads/2018/11/avi-networks-multi-cloud-application-services-platform-diagram.png" data-action="zoom" alt="Conceptual Diagram"  class="lazyload">
  </a>
  
</figure></p>
<p>The data plate is Avi’s SEs (Service Engines). These are the customer-facing devices that are used to pass traffic. While passing traffic, they collect valuable stats that you are able to see in the Controller portal.</p>
<p>Features such as SSL/TLS offloading is something we have grown accustomed to in Load Balancers and Avi deliver this in their SE profiles along with other features.</p>
<h3 id="data-plane-scaling">Data Plane Scaling<a class="anchorjs-link" href="#data-plane-scaling"></a></h3><p>Auto-scaling with Avi is the concept I found most interesting. This is something we have seen in public cloud providers for a while and it’s great to see it being offered on-prem. There are 2 concepts to grasp here, first is the scaling of SE resources and 2nd is the scaling of VIP (Virtual IP) advertisements.</p>
<p>There are 2 types of SE resource scaling, virtual scaling and horizontal scaling. Virtual scaling is an SE having 95% utilisation, then adding more vCPU and/or vRAM (reboot required). Horizontal scaling is done by adding more nodes, so rather than increasing the resources on 1 Load Balancer, make a second and/or third SE and split the traffic amongst them. Then there are 2 types of VIP scaling within the horizontal scaling methods, Native and BGP-based.</p>
<p>Native scaling is simpler to accomplish and has it’s used cases, but there are limitations. The SEs are able to scale out horizontally to cater for more load. This can be done manually or automatically depending on your preference. This works well, except for the fact while scaling out, there will be 1 primary SE and n secondary SEs (2 recommended). All initial connections will be received by the primary SE and it will forward these connections to the other SEs or opt to serve the content itself. Important to note, this is only to establish the connection. Once a decision has been made as to which SE will serve the content, the traffic between the SE and the user is direct (i.e. not via the primary SE). This works fine, but we have to keep in mind that the bottleneck here is the primary SEs ability to proxy these connection requests and the fact you have a single failover object. SE’s will promote themselves if the primary is lost, but this takes a few seconds.</p>
<p>BGP-based scaling is more dynamic than native scaling and I think we all assumed it would be. The Mechanism at play here is BGP and RHI (Route Health Injection). Each of the SE’s will peer with upstream BGP devices. Once the SEs front a VIP, a /32 (IPv4) or /128 (IPv6) is advertised to the upstream BGP peers and you have multiple routes to the same VIP, creating ECMP southbound from the DC fabric. The SE’s can scale to 64 ECMP objects, where typically routers will have a maximum of 8 ECMP paths (soft or hard limit), keep that in mind.</p>
<p><figure>
  <a class="paragraph-image">
    <img data-src="https://avinetworks.com/docs/latest/architectural-overview/infrastructure/img/architecture_2-1.jpg" data-action="zoom" alt="Logial Design"  class="lazyload">
  </a>
  
</figure></p>
<h3 id="closing">Closing<a class="anchorjs-link" href="#closing"></a></h3><p>Over the course of the next few months, I will be diving into the Avi product, focusing on the base configuration, auto-scaling and redirections. That said, if there is another area you would like me to investigate and blog about, please reach out to me in the comments section or <a href="https://twitter.com/UltTransformer" target="_blank">twitter</a>.</p>


        <hr style="visibility: hidden;" />
        <ul class="pager">
          
          <li class="previous">
            <a href="/posts/vcdx/vcdx-nv-defence-scenario/" data-toggle="tooltip" data-placement="top" title="VCDX-NV">
              Previous<br>
              <span>VCDX-NV</span>
            </a>
          </li>
          
          
          <li class="next">
            <a href="/posts/avi-networks-alb/avi-networks-base-configuration/" data-toggle="tooltip" data-placement="top" title="Avi Networks | NSX ALB">
              Next<br>
              <span>Avi Networks | NSX ALB</span>
            </a>
          </li>
          
        </ul>
        <hr style="visibility: hidden;" />

        
        



<div class="giscus" id="comments"></div>
<script src="https://giscus.app/client.js" 
  data-repo="roninro/hugo-theme-puppet" 
  data-repo-id="R_kgDOHuvyhw"
  data-category="General"
  data-category-id="DIC_kwDOHuvyh84CQjDo"
  data-mapping="pathname"
  data-strict="0" 
  data-reactions-enabled="1" 
  data-emit-metadata="0" 
  data-input-position="top"
  data-theme="light_tritanopia"
  data-lang="en"
  crossorigin="anonymous"
  async>
  </script>




      </div>

      
      
      
      
      <div class="
              col-lg-8 col-lg-offset-2
              col-md-10 col-md-offset-1
              sidebar-container">

        
        
        <section>
  
  
  <hr class="hidden-sm hidden-xs">
  
  <h5>FEATURED TAGS</h5>
  <div class="tags">
    
    <a href="/tags/nsx/">NSX</a>
    
    <a href="/tags/vcdx/">VCDX</a>
    
  </div>
</section>

        
        

      </div>
    </div>
  </div>
</article>



  
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        
        <ul class="list-inline text-center">

<li>
  <a href="https://github.com/UltTransformer" target="_blank">
    <span class="fa-stack fa-lg">
      <i class="fa fa-circle fa-stack-2x"></i>
      <i class="fab fa-github fa-stack-1x fa-inverse"></i>
    </span>
  </a>
</li>

<li>
  <a href="https://linkedin.com/in/chrisgrahamnoon" target="_blank">
    <span class="fa-stack fa-lg">
      <i class="fa fa-circle fa-stack-2x"></i>
      <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
    </span>
  </a>
</li>

<li>
  <a href="https://twitter.com/UltTransformer" target="_blank">
    <span class="fa-stack fa-lg">
      <i class="fa fa-circle fa-stack-2x"></i>
      <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
    </span>
  </a>
</li>


<li>
  <a href="/index.xml" target="_blank">
    <span class="fa-stack fa-lg">
      <i class="fa fa-circle fa-stack-2x"></i>
      <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
    </span>
  </a>
</li></ul>

        <p class="copyright text-muted">
          Copyright &copy; UltTransformer 2023  
          <br>
          Powered by <a href="https://gohugo.io">Hugo</a>
        </p>
      </div>
    </div>
  </div>
</footer>

<script src=/js/jquery.min.js></script>
<script src=/js/bootstrap.min.js crossorigin="anonymous"></script>



<script src="/js/hux-blog.min.c4ea77041cd3edbfc8b2622cd887a9a5d8760a4162d14489e36d2a3fa4c90172.js"></script>


<script src=/js/simple-jekyll-search.min.js></script>


<script src="/js/search.min.53bce5da475b4d362500e5ce5dddfa22e20e1b9018777411d2020b4b839c9310.js"></script>













<script src="/zoomjs/zoom.min.js"></script>

</body>

</html>